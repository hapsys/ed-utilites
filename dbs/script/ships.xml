<?xml version="1.0" encoding="UTF-8"?>
<include>
    <table name="ship_classes">
		<select name="ByPrimaryKey" single_object="true">
			<column name="ship_class_id"/>
		</select>
		<select name="ActiveByUniq" single_object="true">
			<column name="ship_class_uniq"/>
			<column name="is_deleted" condition="=" value="0"/>
		</select>
		<update name="ByPrimaryKey">
			<column name="ship_class_id"/>
		</update>
        <query name="ClassesUsingShips">
            <sql>
                SELECT c.*, GROUP_CONCAT(DISTINCT s.ship_name ORDER BY s.ship_name SEPARATOR ', ') as ships
                FROM ship_classes c 
                LEFT JOIN  class_ship cs ON c.ship_class_id = cs.ship_class_id
                LEFT JOIN  ships s ON cs.ship_id = s.ship_id
                WHERE 1=1
				GROUP BY c.ship_class_id
                ORDER BY c.sort
            </sql>
        </query>
        <query name="AllShipsAndClasses">
            <sql>
                SELECT c.*, s.*
                FROM ship_classes c, class_ship cs, ships s
                WHERE c.ship_class_id = cs.ship_class_id
                AND cs.ship_id = s.ship_id
                ORDER BY c.sort, s.ship_name
            </sql>
        </query>
    </table>
    <table name="ships">
		<select name="ByPrimaryKey" single_object="true">
			<column name="ship_id"/>
		</select>
		<update name="ByPrimaryKey">
			<column name="ship_id"/>
		</update>
		<query name="ShipListWithClasses">
			<sql>
				SELECT s.*, GROUP_CONCAT(DISTINCT c.ship_class_name ORDER BY c.sort SEPARATOR ', ') as ship_classes
				FROM ships s
				LEFT JOIN class_ship cs ON cs.ship_id = s.ship_id
				LEFT JOIN  ship_classes c ON c.ship_class_id = cs.ship_class_id
				GROUP BY s.ship_id
                ORDER BY s.ship_name
			</sql>
		</query>
		<query name="ShipUsingClasses">
			<column name="ShipId"/>
			<sql>
				SELECT s.*, c.*, cs.ship_id as class_using
				FROM (ship_classes c, ships s)
				LEFT JOIN class_ship cs ON cs.ship_id = s.ship_id AND c.ship_class_id = cs.ship_class_id
				WHERE s.ship_id = ?
				ORDER BY c.sort
			</sql>
		</query>
    </table>
    <table name="class_ship">
		<select name="ByPrimaryKey" single_object="true">
			<column name="ship_id"/>
			<column name="ship_class_id"/>
		</select>
		<delete name="ByPrimaryKey">
			<column name="ship_id"/>
			<column name="ship_class_id"/>
		</delete>
    </table>
</include>